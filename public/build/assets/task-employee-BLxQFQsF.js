import{r as d,W,q as G,j as e,a as J,b as K}from"./app-DcosoOGz.js";import{H as U,N as X}from"./Header-CpISEJT8.js";import{N as Y}from"./notyf.min-DLu_xjpT.js";import{M as Z}from"./index-BqqysFL3.js";import"./index-BdICc8gQ.js";import"./iconBase-BoGeFUZy.js";import"./index-CWrYJs3k.js";const c=new Y,he=({user:E,tasks:j,user_type:P,notif:C,taskcategory:T,employee:y,projects:i,userss:l})=>{const[x,ee]=d.useState(""),[N,A]=d.useState([]),[f,F]=d.useState(1),[u]=d.useState(10),[L,D]=d.useState(!1),[M,se]=d.useState(""),[g,te]=d.useState(""),{data:a,setData:v,post:H,errors:re}=W({task_name:"",estimate_hours:"",sdate:"",edate:"",employee_id:[],status:"",rate:"",project_id:i.length>0?i[0].id:""}),{props:I}=G();console.log("abcd",l),console.log("userss value and type:",l,typeof l),d.useEffect(()=>{const t=j.flatMap(r=>r.tasks).filter(r=>(x===""||r.task_name.toLowerCase().includes(x.toLowerCase())||r.users.some(o=>o.name.toLowerCase().includes(x.toLowerCase())))&&(g===""||j.some(o=>o.title.toLowerCase().includes(g.toLowerCase())&&o.tasks.includes(r))));A(t)},[x,g,j]);const h=s=>{const{name:t,value:r}=s.target;console.log(`Selected ${t}: ${r}`),v(o=>({...o,[t]:r}))},O=()=>{D(!1)},w=f*u,$=w-u,_=N.slice($,w),q=Math.ceil(N.length/u),B=Array.from({length:q},(s,t)=>t+1),n=i.find(s=>s.id===parseInt(a.project_id));console.log("Selected Project:",n);const S=(s,t)=>{v("employee_id",s.map(r=>r.id))},Q=async s=>{s.preventDefault(),console.log("Project ID:",a.project_id),console.log("Projects Array:",i);const t=parseInt(a.project_id),r=i.find(m=>m.id===t);if(!r){c.error("Selected project not found."),console.error("Selected project not found.");return}const o=parseFloat(a.estimate_hours);try{const m=await K.get(`/project-tasks/${t}/total-hours`),V=parseFloat(m.data.total_hours)+o,k=parseFloat(r.estimate_time);if(V>k){c.error(`Total hours exceed the allowed limit for the project. Maximum allowed: ${k} hours.`);return}H("/task-store",{data:a,onSuccess:()=>{c.success("Task created successfully with notification sent.")},onError:p=>{typeof p=="object"&&p!==null?Object.entries(p).forEach(([le,b])=>{Array.isArray(b)?b.forEach(z=>c.error(z)):c.error(b)}):c.error("An unexpected error occurred."),console.error("Server-side validation errors:",p)}})}catch(m){console.error("Error fetching total task hours:",m),c.error("Failed to validate project hours. Please try again later.")}},R=a.task_name.replace(/\u00A0/g," ").trim();return e.jsxs("div",{className:"w-[85.2%] absolute right-0 overflow-hidden",children:[e.jsx(U,{user:E,notif:C}),e.jsx(X,{user_type:P}),e.jsxs("div",{className:"px-8 table-section",children:[e.jsx("div",{className:"flex justify-between",children:e.jsx("div",{className:"flex"})}),e.jsx("br",{}),(l==null?void 0:l.type)===1?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900",children:"Assign Task:"}),e.jsx("input",{type:"text",placeholder:"Enter task name",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("table",{className:"w-full border border-collapse border-gray-200 table-auto",children:[e.jsx("thead",{className:"bg-[#0A1B3F] text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"Project Name"}),e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"Rate"}),e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"Start Date"}),e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"End Date"}),e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"Estimate Time hours"}),e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"Priority"}),e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"Actions"})]})}),e.jsx("tbody",{children:_.length>0?_.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 border border-gray-300 text-[0.9rem]",children:s.task_name}),e.jsx("td",{className:"px-4 py-2 border border-gray-300 text-[0.9rem]",children:s.rate}),e.jsx("td",{className:"px-4 py-2 border border-gray-300 text-[0.9rem]",children:s.sdate}),e.jsx("td",{className:"px-4 py-2 border border-gray-300 text-[0.9rem]",children:s.edate}),e.jsx("td",{className:"px-4 py-2 border border-gray-300 text-[0.9rem]",children:s.estimate_hours}),e.jsx("td",{className:`px-4 py-2 font-semibold border border-gray-300 text-[0.9rem] ${s.priority===0?"text-green-600":s.priority===1?"text-amber-600":"text-red-500"}`,children:s.priority===0?"Low":s.priority===1?"Medium":"High"}),e.jsx("td",{className:"border border-gray-300",children:e.jsx("div",{className:"flex px-4 py-2 space-x-2",children:I.permission.includes("edit_task")&&e.jsx(J,{href:`/task-assing-all/${s.id}`,children:e.jsx("span",{className:"text-blue-500 cursor-pointer hover:text-blue-700",children:"Assign Employee"})})})})]},t)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"p-3 text-center",children:"No tasks found"})})})]})]}):e.jsx("div",{className:"p-6 bg-white shadow-md rounded-lg",children:e.jsxs("div",{className:"p-6 bg-white shadow-md rounded-lg",children:[e.jsxs("div",{className:"mb-4 text-lg font-semibold text-gray-800",children:["ðŸ· ",e.jsx("strong",{children:"Assigning Task to:"})," ",e.jsx("span",{className:"text-blue-600",children:l==null?void 0:l.name})]}),n?e.jsxs("div",{className:"p-4 border rounded-lg bg-gray-50",children:[e.jsx("h3",{className:"mb-2 text-xl font-semibold text-gray-800",children:"ðŸ“Œ Project Details"}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Project Name:"})," ",e.jsx("span",{className:"font-semibold text-blue-600",children:n.title})]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Start Date:"})," ",e.jsx("span",{className:"font-semibold",children:n.start_date})]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"End Date:"})," ",e.jsx("span",{className:"font-semibold",children:n.end_date})]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Estimate Time:"})," ",e.jsxs("span",{className:"font-semibold",children:[n.estimate_time," ","hours"]})]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Progress:"})," ",e.jsxs("span",{className:"font-semibold",children:[n.progress,"%"]})]})]}):e.jsx("div",{className:"text-red-500",children:"âš  No project selected"})]})}),e.jsx("div",{className:"flex justify-center mt-4",children:B.map(s=>e.jsx("button",{onClick:()=>F(s),className:`px-4 py-2 mx-1 rounded ${f===s?"bg-blue-500 text-white":"bg-gray-200"}`,children:s},s))})]}),L&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx("form",{onSubmit:Q,className:"px-[8rem] items-center justify-center ",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Copied Project Name"}),e.jsx("input",{type:"text",value:M,readOnly:!0,className:"w-full p-2 border rounded-md mb-4"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"task_name",children:"Task Name"}),e.jsxs("select",{className:"w-full rounded-lg",name:"task_name",value:a.task_name,onChange:h,children:[e.jsx("option",{value:"",children:"Select task"}),T.map(s=>e.jsx("option",{value:s.tname,children:s.tname},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sdate",children:"Start Date"}),e.jsx("input",{className:"w-full rounded-lg",id:"sdate",name:"sdate",type:"date",value:a.sdate,onChange:h,required:!0})]}),e.jsx("div",{children:R!=="NON-BILLABLE"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"estimate_hours",children:"Estimate Hours"}),e.jsx("input",{className:"w-full rounded-lg",id:"estimate_hours",name:"estimate_hours",type:"number",value:a.estimate_hours,onChange:h})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edate",children:"End Date"}),e.jsx("input",{className:"w-full rounded-lg",id:"edate",name:"edate",type:"date",value:a.edate,onChange:h,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"employee_id",children:"Assign Employees"}),e.jsx(Z,{options:y,selectedValues:a.employee_id.map(s=>y.find(t=>t.id===s)),onSelect:S,onRemove:S,displayValue:"name",placeholder:"Select Employees"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:O,className:"mt-4 px-4 py-2 bg-red-500 text-white rounded",children:"Close"}),e.jsx("button",{type:"submit",className:"mt-4 px-4 py-2 bg-green-500 text-white rounded",children:"Create"})]})]})})})]})};export{he as default};
