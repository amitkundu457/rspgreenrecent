import{W as H,r,q,j as e}from"./app-D84j7SCT.js";import{H as D,N as B}from"./Header-C3uwYM-0.js";import"./choices.min-CuoMaeW1.js";import{N as W}from"./notyf.min-DLu_xjpT.js";import{n as $,d as I}from"./index-D4x-ylCN.js";import"./iconBase-Cc3CELI8.js";import"./index-TAr1_Bl1.js";const c=new W,te=({employees:v,projects:m,taskcategory:X,user:C,user_type:S,notif:k,stages:x,tls:G,allEmployees:j,designation:J})=>{var g,w,b,_;const{data:l,setData:y,post:F,errors:f}=H({task_name:"",estimate_hours:"",sdate:"",edate:"",leader_id:[],employee_id:[],employee_hours:{},status:"",priority:0,rate:"",project_id:m.length>0?m[0].id:""});console.log("employee details",j),r.useState(!1),r.useState([]);const[E,K]=r.useState("");r.useState("");const[d,u]=r.useState([{name:"",description:"",ammount:0}]),A=()=>{u([...d,{name:"",description:"",ammount:0}])},R=t=>{u(d.filter((a,s)=>s!==t))},P=(t,a,s)=>{const n=[...d];n[t][a]=s;{const p=x.find(i=>i.name===s);n[t].ammount=p?p.ammount:0}u(n)};r.useState({employee_id:[],time_allocation:""}),(g=j.find(t=>t.id===E))==null||g.employee_name;const{props:h}=q();r.useRef(null),r.useRef(null),((w=h.auth.user.roles[0])==null?void 0:w.name)==="admin"&&r.useEffect(()=>()=>{},[]);const o=t=>{const{name:a,value:s}=t.target;y(n=>({...n,[a]:s}))},T=(t,a)=>{y(s=>({...s,employee_hours:{...s.employee_hours,[t]:a}}))},L=async t=>{t.preventDefault();const a=parseInt(l.project_id);if(!m.find(n=>n.id===a)){c.error("Selected project not found.");return}parseFloat(l.estimate_hours),F("/task-store",{data:l,onSuccess:()=>{c.success("Task created successfully with notification sent.")},onError:n=>{typeof n=="object"&&n!==null?Object.entries(n).forEach(([p,i])=>{Array.isArray(i)?i.forEach(z=>c.error(z)):c.error(i)}):c.error("An unexpected error occurred.")}})},N=l.task_name.replace(/\u00A0/g," ").trim(),O=()=>{const t={key:"rzp_test_XaqbXFTW6WTuAK",amount:100,currency:"INR",name:"Acme Corp",description:"Test Transaction",image:"https://cdn.razorpay.com/logos/GhRQcyean79PqE_medium.png",handler:function(s){Inertia.post("/payment-success",s)},prefill:{name:"John Doe",email:"john.doe@example.com",contact:"9000090000"},notes:{address:"Corporate Office"},theme:{color:"#3399cc"}};new window.Razorpay(t).open()};return e.jsxs("div",{className:"w-[85.2%] ml-[12rem]",children:[e.jsx(D,{user:C,notif:k}),e.jsx(B,{user_type:S}),e.jsx("div",{className:"flex flex-col gap-6",children:e.jsx("div",{className:"flex items-center justify-between"})}),e.jsx("div",{className:"p-3 table-section",children:e.jsxs("form",{onSubmit:L,className:"px-[8rem] flex flex-wrap",children:[e.jsxs("div",{className:"w-1/2 p-2",children:[e.jsx("label",{htmlFor:"task_name",children:"Project Name"}),e.jsx("input",{type:"text",name:"task_name",className:"w-full rounded-lg",value:l.task_name,onChange:o}),f.name&&e.jsx("div",{children:f.name})]}),e.jsx("div",{className:"w-1/2 p-2",children:N!=="NON-BILLABLE"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"rate",children:"Rate"}),e.jsx("input",{className:"w-full rounded-lg",id:"rate",name:"rate",type:"number",value:l.rate,onChange:o})]})}),e.jsx("div",{className:"w-1/2 p-2",children:N!=="NON-BILLABLE"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"estimate_hours",children:"Estimate Hours"}),e.jsx("input",{className:"w-full rounded-lg",id:"estimate_hours",name:"estimate_hours",type:"number",value:l.estimate_hours,onChange:o})]})}),((b=h.auth.user.roles[0])==null?void 0:b.name)==="admin"&&e.jsx(r.Fragment,{}),l.employee_id.length>0&&e.jsx("div",{className:"w-1/2 p-2",children:l.employee_id.map(t=>{var a;return e.jsxs("div",{children:[e.jsxs("label",{htmlFor:`employee_hours_${t}`,children:["Hours for"," ",(a=v.find(s=>s.id===parseInt(t)))==null?void 0:a.name," ",":"]}),e.jsx("input",{className:"w-full rounded-lg",type:"number",id:`employee_hours_${t}`,name:`employee_hours_${t}`,value:l.employee_hours[t]||"",onChange:s=>T(t,s.target.value)})]},t)})}),e.jsxs("div",{className:"w-1/2 p-2",children:[e.jsx("label",{htmlFor:"sdate",children:"Start Date"}),e.jsx("input",{className:"w-full rounded-lg",id:"sdate",name:"sdate",type:"date",value:l.sdate,onChange:o,required:!0})]}),e.jsxs("div",{className:"w-1/2 p-2",children:[e.jsx("label",{htmlFor:"edate",children:"End Date"}),e.jsx("input",{className:"w-full rounded-lg",id:"edate",name:"edate",type:"date",value:l.edate,onChange:o,required:!0})]}),e.jsxs("div",{className:"w-1/2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Priority"}),e.jsxs("select",{id:"",className:"w-full rounded-lg",name:"priority",value:l.priority,onChange:o,children:[e.jsx("option",{value:"",children:"-- Select Priority --"}),e.jsx("option",{value:"0",children:"Low"}),e.jsx("option",{value:"1",children:"Medium"}),e.jsx("option",{value:"2",children:"High"})]})]}),((_=h.auth.user.roles[0])==null?void 0:_.name)==="admin"&&e.jsxs("div",{className:"w-full p-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Project Stage"}),e.jsx("button",{type:"button",onClick:A,className:"text-sm font-semibold bg-blue-500 text-white px-4 py-2 rounded",children:"Add New"})]}),e.jsxs("table",{className:"my-2 w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 bg-gray-600 text-white rounded-l",children:"#"}),e.jsx("th",{className:"px-3 py-2 bg-gray-600 text-white",children:"Name"}),e.jsx("th",{className:"px-3 py-2 bg-gray-600 text-white",children:"Payment"}),e.jsx("th",{className:"px-3 py-2 bg-gray-600 text-white rounded-r",children:"Action"})]})}),e.jsx("tbody",{children:d.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2",children:a+1}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("select",{className:"w-full rounded form-select",value:t.name,onChange:s=>{const n=s.target.value;console.log("Selected Option:",n),P(a,"name",n)},children:[e.jsx("option",{value:"",disabled:!0,children:"Select a name"}),x.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"text",className:"w-full rounded form-input",value:t.ammount,readOnly:!0})}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{className:"px-2 py-2 text-indigo-500",type:"button",onClick:()=>O(),children:e.jsx($,{})}),e.jsx("button",{className:"px-2 py-2 text-red-500",type:"button",onClick:()=>R(a),children:e.jsx(I,{})})]})})]},a))})]})]}),e.jsx("div",{className:"w-full p-2",children:e.jsx("button",{type:"submit",className:"bg-blue-600 p-2 rounded-md text-white w-[30%]",children:"Create"})})]})})]})};export{te as default};
