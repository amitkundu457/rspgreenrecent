import{r as n,W as M,b as j,j as e,a as I}from"./app-D84j7SCT.js";import{H as P,N as T}from"./Header-C3uwYM-0.js";import{D as f}from"./react-datepicker-DrzdbLRG.js";import{b as $,c as U,d as H}from"./index-D4x-ylCN.js";import"./iconBase-Cc3CELI8.js";import"./index-TAr1_Bl1.js";import"./clsx-B-dksMZM.js";const K=({user:N,user_type:w,notif:v,loans:c,us:D})=>{const[O,_]=n.useState([]);n.useState("");const[i,C]=n.useState(""),[m,x]=n.useState(!1),{data:a,setData:r,post:L,reset:S}=M({employee_name:"",registration:"",amount:"",repayment_terms:"onetime",start_date:"",end_date:"",months:2,monthly_installment:"",document:null,status:"Pending",reason:"",duration_months:""}),[u,k]=n.useState(""),[Q,h]=n.useState(null);n.useEffect(()=>{p()},[]),n.useEffect(()=>{if(a.repayment_terms==="monthly"&&a.amount&&a.months){const t=(a.amount/a.months).toFixed(0);r("monthly_installment",t)}else r("monthly_installment","")},[a.amount,a.months,a.repayment_terms]);const p=async()=>{try{x(!0);const t=await j.get("/loans");_(t.data)}catch(t){console.error("Error fetching loan data:",t),alert("An error occurred while fetching loan data.")}finally{x(!1)}},E=t=>{C(t.target.value)},A=c.filter(t=>{var s;return t.employee_name.toLowerCase().includes(i.toLowerCase())||((s=t.employee_id)==null?void 0:s.toLowerCase().includes(i.toLowerCase()))});if(m)return e.jsx("div",{children:"Loading..."});const g=t=>{const s=t.target.value;r("repayment_terms",s),s==="onetime"&&(r("start_date",""),r("end_date",""),r("monthly_installment",""),r("months",2))},R=t=>{const s=t.target.files[0];if(r("document",s),k(s.name),s.type.startsWith("image/")){const l=new FileReader;l.onloadend=()=>{h(l.result)},l.readAsDataURL(s)}else h(null)},F=()=>{L("/loans",{onSuccess:()=>{alert("Loan added successfully!"),p(),S()},onError:t=>{console.error(t),alert("An error occurred while adding the loan.")}})},o=async(t,s)=>{if(!["Approved","Rejected"].includes(s)){console.error("Invalid status:",s),alert("The selected status is invalid.");return}try{const d=await j.put(`/loans/${t}`,{status:s});d.status===200?console.log("Status updated successfully"):(console.error("Error response data:",d.data),alert("Failed to update status"))}catch(d){console.error("Error updating status:",d),alert("An error occurred while updating the status.")}};return e.jsxs("div",{className:"w-[85.2%] absolute right-0 overflow-hidden",children:[e.jsx(P,{user:N,notif:v}),e.jsx(T,{user_type:w}),e.jsxs("div",{className:"container mx-auto p-6 bg-gray-50 rounded-lg shadow-xl max-w-5xl",children:[e.jsx("h1",{className:"text-3xl font-bold text-center text-blue-800 mb-6",children:"Loan Management Portal"}),D!==1?e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Employee Name"}),e.jsx("input",{type:"text",value:a.employee_name,onChange:t=>r("employee_name",t.target.value),className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Designation"}),e.jsx("input",{type:"text",value:a.registration,onChange:t=>r("registration",t.target.value),className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Loan Amount"}),e.jsx("input",{type:"number",value:a.amount,onChange:t=>r("amount",t.target.value),className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Repayment Type"}),e.jsxs("div",{className:"flex items-center mt-2 space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"repayment_terms",value:"onetime",checked:a.repayment_terms==="onetime",onChange:g,className:"h-4 w-4"}),e.jsx("span",{children:"One-Time"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"repayment_terms",value:"monthly",checked:a.repayment_terms==="monthly",onChange:g,className:"h-4 w-4"}),e.jsx("span",{children:"Monthly"})]})]})]})]}),a.repayment_terms==="monthly"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Installment Months"}),e.jsx("select",{value:a.months,onChange:t=>r("months",t.target.value),className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500",children:Array.from({length:11},(t,s)=>e.jsxs("option",{value:s+2,children:[s+2," Months"]},s+2))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Monthly Installment"}),e.jsx("input",{type:"text",value:a.monthly_installment,readOnly:!0,className:"mt-1 w-full border border-gray-300 rounded-md p-2 bg-gray-100 text-gray-700"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Start Date"}),e.jsx(f,{selected:a.start_date,onChange:t=>r("start_date",t),dateFormat:"yyyy-MM-dd",className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"End Date"}),e.jsx(f,{selected:a.end_date,onChange:t=>r("end_date",t),dateFormat:"yyyy-MM-dd",className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Upload Document"}),e.jsx("input",{type:"file",onChange:R,className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500"})]}),u&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Uploaded Document: ",u]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Reason for Loan"}),e.jsx("textarea",{value:a.reason,onChange:t=>r("reason",t.target.value),className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500",rows:"3"})]}),e.jsxs("button",{onClick:F,className:"w-full py-2 px-4 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 flex items-center justify-center",children:[m?e.jsx($,{className:"animate-spin mr-2"}):null,"Submit Loan"]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Employee Loan Details"}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-300 bg-white shadow-lg rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-blue-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"Start Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"End Date"}),e.jsx("th",{className:"px-6 py-3 text-center text-sm font-bold text-white uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-sm font-bold text-white uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:c.map(t=>{var s,l;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:t.amount}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:new Date(t.start_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:new Date(t.end_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold text-white ${((s=t.status)==null?void 0:s.toLowerCase())==="approved"?"bg-green-600":((l=t.status)==null?void 0:l.toLowerCase())==="rejected"?"bg-red-600":"bg-orange-500"}`,children:t.status})}),e.jsxs("td",{className:"px-6 py-4 flex justify-center items-center space-x-2",children:[e.jsx("button",{onClick:()=>handleEditLoan(t.id),className:"flex items-center justify-center w-8 h-8 bg-yellow-600 text-white rounded-full shadow-lg hover:bg-yellow-700",title:"Edit",children:e.jsx(U,{})}),e.jsx("button",{onClick:()=>handleDeleteLoan(t.id),className:"flex items-center justify-center w-8 h-8 bg-red-600 text-white rounded-full shadow-lg hover:bg-red-700",title:"Delete",children:e.jsx(H,{})})]})]},t.id)})})]})]})]}):null,e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Existing Loans"}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by Employee Name or ID",className:"p-2 border border-gray-300 rounded-lg w-full",value:i,onChange:E})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300 bg-white shadow-lg rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-blue-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"Employee ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"Employee Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"Designation"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"Start Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"End Date"}),e.jsx("th",{className:"px-6 py-3 text-center text-sm font-bold text-white uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-sm font-bold text-white uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:A.map(t=>{var s,l,d,y,b;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:t.id})," ",e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:t.employee_name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:t.registration}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:t.amount}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:new Date(t.start_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:new Date(t.end_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold text-white ${((s=t.status)==null?void 0:s.toLowerCase())==="approved"?"bg-green-600":((l=t.status)==null?void 0:l.toLowerCase())==="rejected"?"bg-red-600":"bg-orange-500"}`,children:t.status})}),e.jsxs("td",{className:"px-6 py-4 flex justify-center items-center space-x-2",children:[((d=t.status)==null?void 0:d.toLowerCase())==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>o(t.id,"Approved"),className:"px-3 py-1 text-sm bg-green-600 text-white rounded-md shadow-md hover:bg-green-700 transition-all duration-200",title:"Approve",children:"Approve"}),e.jsx("button",{onClick:()=>o(t.id,"Rejected"),className:"px-3 py-1 text-sm bg-red-600 text-white rounded-md shadow-md hover:bg-red-700 transition-all duration-200",title:"Reject",children:"Reject"})]}),((y=t.status)==null?void 0:y.toLowerCase())==="approved"&&e.jsx("button",{onClick:()=>o(t.id,"Rejected"),className:"px-3 py-1 text-sm bg-red-600 text-white rounded-md shadow-md hover:bg-red-700 transition-all duration-200",title:"Reject",children:"Reject"}),((b=t.status)==null?void 0:b.toLowerCase())==="rejected"&&e.jsx("button",{onClick:()=>o(t.id,"Approved"),className:"px-3 py-1 text-sm bg-green-600 text-white rounded-md shadow-md hover:bg-green-700 transition-all duration-200",title:"Approve",children:"Approve"}),e.jsx(I,{href:`/loan-details/${t.id}`,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-md shadow-md hover:bg-blue-700 transition-all duration-200",title:"View Details",onClick:()=>console.log(`Navigating to loan details of loan ID: ${t.id}`),children:"View Details"})]})]},t.id)})})]})})]})]})]})};export{K as default};
