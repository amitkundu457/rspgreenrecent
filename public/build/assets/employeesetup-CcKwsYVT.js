import{r as c,W as $,j as r}from"./app-DcosoOGz.js";import H from"./sidebar-CUMbj9-a.js";import{H as U,N as q}from"./Header-CpISEJT8.js";import{M as N}from"./Modal-CH8CXeO6.js";import{N as L}from"./notyf.min-DLu_xjpT.js";import"./index-BdICc8gQ.js";import"./iconBase-BoGeFUZy.js";import"./index-CWrYJs3k.js";import"./transition-C8N8PgM5.js";const ee=({user:_,notif:v,user_type:w,branchesa:d,searchEmpCount:R,employees:C,holiday:u})=>{const[B,p]=c.useState(!1),[k,x]=c.useState(!1),[i,b]=c.useState(null),[W,S]=c.useState(null),[z,f]=c.useState([]);console.log("kjhgf",u);const t=new L,{data:s,setData:o,post:T,reset:j,errors:F}=$({b_name:"",transfer_to:"",location_name:"",location_id:""});c.useEffect(()=>{y()},[]);const y=async()=>{try{const e=await axios.get("/branches");f(e.data)}catch(e){console.error("Error fetching branches:",e)}},g=(e=null)=>{p(!0),o("b_name",e?e.b_name:""),b(e?e.id:null)},m=()=>{p(!1),b(null),j("b_name")},E=e=>{x(!0),o("current_branch",e),console.log("Branch ID:",e)},h=()=>{x(!1),j("transfer_to")},M=e=>{e.preventDefault();const n=s.selectedBranchId?`/branches-update/${i}`:"/branches";T(n,{onSuccess:()=>{t.success(i?"Branch updated successfully!":"Branch created successfully!"),y(),m()},onError:()=>{t.error("An error occurred while saving the branch.")}})},D=async e=>{var n,a;if(e.preventDefault(),s.current_branch===s.transfer_to){t.error("Employee is already in this branch.");return}console.log("Transfer Data:",{current_branch:s.current_branch,transfer_to:s.transfer_to,employee_id:s.employee_id});try{const l=await axios.post(`/branches-transfer/${s.current_branch}`,{transfer_to:s.transfer_to,employee_id:s.employee_id});l.data.success&&(t.success(l.data.success),h(),S(I=>I.filter(O=>O.id!==s.employee_id)),window.location.reload())}catch(l){(a=(n=l.response)==null?void 0:n.data)!=null&&a.error?t.error(l.response.data.error):t.error("An error occurred while transferring the employee."),console.error(l)}},A=async(e,n)=>{if(n){t.error("This branch has employees, so deletion is not allowed.");return}else if(confirm("Are you sure you want to delete this branch?"))try{console.log("Attempting to delete branch with ID:",e),await axios.delete(`/branches/${e}`),t.success("Branch deleted successfully!"),window.location.reload(),f(a=>Array.isArray(a)?a.filter(l=>l.id!==e):[])}catch(a){console.error("Error deleting branch:",a),a.response&&a.response.status===404?t.error("Branch not found. Deletion failed."):t.error("An error occurred while deleting the branch.")}};return r.jsxs("div",{className:"w-[85.2%] absolute right-0",children:[r.jsx(U,{user:_,notif:v}),r.jsx(q,{user_type:w}),r.jsxs("div",{className:"flex px-9",children:[r.jsx(H,{}),r.jsxs("div",{className:"flex-1 p-6 bg-gray-100",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("h1",{className:"mb-4 text-2xl font-bold",children:"Manage Branch"}),r.jsx("button",{onClick:()=>g(),className:"p-2 text-teal-900 underline rounded-md",children:"Create Branch"})]}),r.jsx("div",{className:"mt-3",children:r.jsxs("table",{className:"min-w-full border border-gray-300",children:[r.jsx("thead",{className:"bg-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-2 text-left border-b",children:"Branch Name"}),r.jsx("th",{className:"px-4 py-2 text-left border-b",children:"Total Employees"}),r.jsx("th",{className:"px-4 py-2 text-right border-b",children:"Action"})]})}),r.jsx("tbody",{children:d.map(e=>r.jsxs("tr",{className:"transition duration-200 hover:bg-gray-100",children:[r.jsx("td",{className:"px-4 py-2 border-b",children:e.name}),r.jsx("td",{className:"px-4 py-2 text-center border-b",children:e.empCount}),r.jsxs("td",{className:"px-4 py-2 text-right border-b",children:[r.jsx("button",{onClick:()=>g(e),className:"text-blue-600 underline hover:text-blue-800",children:"Edit"}),e.empCount!==0&&r.jsx("button",{onClick:()=>E(e.id),className:"ml-4 text-green-600 underline hover:text-green-800",children:"Transfer"}),r.jsx("button",{onClick:()=>A(e.id,e.empCount>0),className:"ml-4 text-red-600 underline hover:text-red-800",children:"Delete"})]})]},e.id))})]})})]})]}),r.jsx(N,{show:B,onClose:m,children:r.jsxs("div",{className:"p-6",children:[r.jsx("h2",{className:"text-lg font-bold",children:i?"Edit Branch":"Create New Branch"}),r.jsxs("form",{onSubmit:M,className:"mt-4",children:[r.jsxs("label",{className:"block mb-2",children:["Branch Name:",r.jsx("input",{type:"text",value:s.b_name,onChange:e=>o("b_name",e.target.value),className:"block w-full p-2 mt-1 border border-gray-300 rounded-md",required:!0})]}),r.jsxs("label",{className:"block mb-2",children:["Location:",r.jsxs("select",{value:s.location_id,onChange:e=>o("location_id",e.target.value),className:"block w-full p-2 mt-1 border border-gray-300 rounded-md",children:[r.jsx("option",{value:"",children:"Select a location"}),u.map((e,n)=>r.jsx("option",{value:e.id,children:e.name},e.id||n))]})]}),r.jsx("button",{type:"submit",className:"p-2 mt-4 text-white bg-blue-600 rounded-md",children:i?"Update Branch":"Create Branch"}),r.jsx("button",{onClick:m,type:"button",className:"p-2 mt-2 text-white bg-red-600 rounded-md",children:"Close"})]})]})}),r.jsx(N,{show:k,onClose:h,children:r.jsxs("div",{className:"p-6",children:[r.jsx("h2",{className:"text-lg font-bold",children:"Transfer Branch"}),r.jsxs("form",{onSubmit:D,className:"mt-4",children:[r.jsxs("label",{className:"block mb-2",children:["Transfer To:",r.jsxs("select",{value:s.transfer_to,onChange:e=>o("transfer_to",e.target.value),className:"block w-full p-2 mt-1 border border-gray-300 rounded-md",children:[r.jsx("option",{value:"",disabled:!0,children:"Select a branch"}),d==null?void 0:d.filter(e=>e.id!==s.current_branch).map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),r.jsxs("label",{className:"block mb-2 mt-4",children:["Select Employee:",r.jsxs("select",{value:s.employee_id,onChange:e=>o("employee_id",e.target.value),className:"block w-full p-2 border border-gray-300 rounded-md",children:[r.jsx("option",{value:"",disabled:!0,children:"Select an employee"}),C.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),r.jsx("button",{type:"submit",className:"p-2 mt-2 text-white bg-green-600 rounded-md",children:"Transfer"}),r.jsx("button",{onClick:h,type:"button",className:"p-2 mt-2 text-white bg-red-600 rounded-md",children:"Close"})]})]})})]})};export{ee as default};
