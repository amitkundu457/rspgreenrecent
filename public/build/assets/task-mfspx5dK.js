import{r as l,W as K,q as X,j as e,a as C,b as E}from"./app-D84j7SCT.js";import{H as Y,N as Z}from"./Header-C3uwYM-0.js";import{c as ee}from"./index-D4x-ylCN.js";import{R as te}from"./index-AGpLmc7r.js";import{N as se}from"./notyf.min-DLu_xjpT.js";import{M as re}from"./index-D_fqicUJ.js";import"./iconBase-Cc3CELI8.js";import"./index-TAr1_Bl1.js";const d=new se,je=({user:P,tasks:i,user_type:T,notif:F,taskcategory:L,employee:b,projects:m})=>{const[n,A]=l.useState(""),[g,D]=l.useState([]),[f,N]=l.useState(1),[p]=l.useState(10),[M,H]=l.useState(!1),[$,ae]=l.useState(""),[u,O]=l.useState(""),{data:o,setData:v,post:I,errors:oe}=K({task_name:"",estimate_hours:"",sdate:"",edate:"",employee_id:[],status:"",rate:"",project_id:m.length>0?m[0].id:""}),{props:j}=X();l.useEffect(()=>{const r=i.flatMap(s=>s.tasks).filter(s=>(n===""||s.task_name.toLowerCase().includes(n.toLowerCase())||s.users.some(a=>a.name.toLowerCase().includes(n.toLowerCase())))&&(u===""||i.some(a=>a.title.toLowerCase().includes(u.toLowerCase())&&a.tasks.includes(s))));D(r)},[n,u,i]);const x=t=>{const{name:r,value:s}=t.target;console.log(`Selected ${r}: ${s}`),v(a=>({...a,[r]:s}))},R=(t,r)=>{t.preventDefault(),confirm("Are you sure you want to delete this task?")&&E.get(`/task-delete/${r}`).then(s=>{d.success("Task and related task assign deleted successfully."),window.location.reload()}).catch(s=>{console.log(s)})},q=()=>{H(!1)},w=f*p,B=w-p,k=g.slice(B,w),Q=Math.ceil(g.length/p),V=Array.from({length:Q},(t,r)=>r+1),z=t=>{A(t.target.value),N(1)},_=(t,r)=>{v("employee_id",t.map(s=>s.id))},U=async t=>{t.preventDefault(),console.log("Project ID:",o.project_id),console.log("Projects Array:",m);const r=parseInt(o.project_id),s=m.find(c=>c.id===r);if(!s){d.error("Selected project not found."),console.error("Selected project not found.");return}const a=parseFloat(o.estimate_hours);try{const c=await E.get(`/project-tasks/${r}/total-hours`),G=parseFloat(c.data.total_hours)+a,S=parseFloat(s.estimate_time);if(G>S){d.error(`Total hours exceed the allowed limit for the project. Maximum allowed: ${S} hours.`);return}I("/task-store",{data:o,onSuccess:()=>{d.success("Task created successfully with notification sent.")},onError:h=>{typeof h=="object"&&h!==null?Object.entries(h).forEach(([de,y])=>{Array.isArray(y)?y.forEach(J=>d.error(J)):d.error(y)}):d.error("An unexpected error occurred."),console.error("Server-side validation errors:",h)}})}catch(c){console.error("Error fetching total task hours:",c),d.error("Failed to validate project hours. Please try again later.")}},W=o.task_name.replace(/\u00A0/g," ").trim();return e.jsxs("div",{className:"w-[85.2%] absolute right-0 overflow-hidden",children:[e.jsx(Y,{user:P,notif:F}),e.jsx(Z,{user_type:T}),e.jsxs("div",{className:"px-8 table-section",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"w-[40%] flex space-x-2",children:[e.jsx("input",{type:"text",value:u,onChange:t=>O(t.target.value),placeholder:"Search projects...",className:"w-full p-2 border rounded-md"}),e.jsx("input",{type:"text",value:n,onChange:z,placeholder:"Search tasks...",className:"w-full p-2 border rounded-md"})]}),e.jsx("div",{className:"flex",children:j.permission.includes("create_task")&&e.jsx("div",{className:"grid p-2 mt-2 text-black underline rounded-lg place-items-center",children:e.jsx(C,{href:"task-create",children:"Add New"})})})]}),e.jsx("br",{}),e.jsxs("table",{className:"w-full border border-collapse border-gray-200 table-auto",children:[e.jsx("thead",{className:"bg-[#0A1B3F] text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"Project Name"}),e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"Rate"}),e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"Start Date"}),e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"End Date"}),e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"Estimate Time hours"}),e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"Priority"}),e.jsx("th",{className:"px-4 py-2 border border-gray-300",children:"Actions"})]})}),e.jsx("tbody",{children:k.length>0?k.map((t,r)=>{var s;return(s=i.find(a=>a.tasks.includes(t)))!=null&&s.title,console.log("Logging task data:",t),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 border border-gray-300 text-[0.9rem]",children:t.task_name}),e.jsx("td",{className:"px-4 py-2 border border-gray-300 text-[0.9rem]",children:t.rate}),e.jsx("td",{className:"px-4 py-2 border border-gray-300 text-[0.9rem]",children:t.sdate}),e.jsx("td",{className:"px-4 py-2 border border-gray-300 text-[0.9rem]",children:t.edate}),e.jsx("td",{className:"px-4 py-2 border border-gray-300 text-[0.9rem]",children:t.estimate_hours}),e.jsx("td",{className:`px-4 py-2 font-semibold border border-gray-300 text-[0.9rem] ${t.priority===0?"text-green-600":t.priority===1?"text-amber-600":"text-red-500"}`,children:t.priority===0?"Low":t.priority==1?"Medium":"High"}),e.jsx("td",{className:"border border-gray-300",children:e.jsxs("div",{className:"flex px-4 py-2 space-x-2 ",children:[j.permission.includes("edit_task")&&e.jsx(C,{href:`/task-edit/${t.id}`,children:e.jsx(ee,{className:"text-blue-500 cursor-pointer hover:text-blue-700"})}),j.permission.includes("delete_task")&&e.jsx(te,{className:"text-red-500 cursor-pointer hover:text-red-700",onClick:a=>R(a,t.id)})]})})]},r)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-3 text-center",children:"No tasks found"})})})]}),e.jsx("div",{className:"flex justify-center mt-4",children:V.map(t=>e.jsx("button",{onClick:()=>N(t),className:`px-4 py-2 mx-1 rounded ${f===t?"bg-blue-500 text-white":"bg-gray-200"}`,children:t},t))})]}),M&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx("form",{onSubmit:U,className:"px-[8rem] items-center justify-center ",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Copied Project Name"}),e.jsx("input",{type:"text",value:$,readOnly:!0,className:"w-full p-2 border rounded-md mb-4"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"task_name",children:"Task Name"}),e.jsxs("select",{className:"w-full rounded-lg",name:"task_name",value:o.task_name,onChange:x,children:[e.jsx("option",{value:"",children:"Select task"}),L.map(t=>e.jsx("option",{value:t.tname,children:t.tname},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sdate",children:"Start Date"}),e.jsx("input",{className:"w-full rounded-lg",id:"sdate",name:"sdate",type:"date",value:o.sdate,onChange:x,required:!0})]}),e.jsx("div",{children:W!=="NON-BILLABLE"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"estimate_hours",children:"Estimate Hours"}),e.jsx("input",{className:"w-full rounded-lg",id:"estimate_hours",name:"estimate_hours",type:"number",value:o.estimate_hours,onChange:x})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edate",children:"End Date"}),e.jsx("input",{className:"w-full rounded-lg",id:"edate",name:"edate",type:"date",value:o.edate,onChange:x,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"employee_id",children:"Assign Employees"}),e.jsx(re,{options:b,selectedValues:o.employee_id.map(t=>b.find(r=>r.id===t)),onSelect:_,onRemove:_,displayValue:"name",placeholder:"Select Employees"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:q,className:"mt-4 px-4 py-2 bg-red-500 text-white rounded",children:"Close"}),e.jsx("button",{type:"submit",className:"mt-4 px-4 py-2 bg-green-500 text-white rounded",children:"Create"})]})]})})})]})};export{je as default};
