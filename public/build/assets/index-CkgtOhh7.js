import{r as o,W as w,j as e,b as _}from"./app-DcosoOGz.js";import{H as k,N as E}from"./Header-CpISEJT8.js";import{D as u}from"./react-datepicker-2VRs0NR0.js";import{b as D}from"./index-BdICc8gQ.js";import"./iconBase-BoGeFUZy.js";import"./index-CWrYJs3k.js";import"./clsx-B-dksMZM.js";const R=({user:x,user_type:b,notif:g,us:h,employees:s,advanceloans:p})=>{const[S,f]=o.useState([]),[y,c]=o.useState(!1),{data:t,setData:l,post:j,reset:N}=w({user_id:"",borrower_name:"",loan_amount:"",loan_date:null,due_date:null,remarks:"",payable_amount:"",remaining_amount:""});console.log("Employees Data:",s);const i=a=>a?a.toISOString().split("T")[0]:null,m=async()=>{try{c(!0);const a=await _.get("/advanceloan");f(a.data)}catch(a){console.error("Error fetching loan data:",a),alert("An error occurred while fetching loan data.")}finally{c(!1)}},v=()=>{j("/advanceloan",{data:{...t,loan_date:i(t.loan_date),due_date:i(t.due_date)},onSuccess:()=>{alert("Advance loan added successfully!"),m(),N()},onError:a=>{console.error(a),alert("An error occurred while adding the loan.")}})};return o.useEffect(()=>{m()},[]),e.jsxs("div",{className:"w-[85.2%] absolute right-0 overflow-hidden",children:[e.jsx(k,{user:x,notif:g}),e.jsx(E,{user_type:b}),e.jsxs("div",{className:"container mx-auto p-6 bg-gray-50 rounded-lg shadow-xl max-w-5xl",children:[e.jsx("h1",{className:"text-3xl font-bold text-center text-blue-800 mb-6",children:"Advance Loan"}),h!==1&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Employee"}),e.jsxs("select",{value:t.id||"",onChange:a=>{const d=a.target.value;if(console.log("Selected ID:",d),!d)return;const r=s==null?void 0:s.find(n=>n.id.toString()===d);console.log("Selected Employee:",r),r&&l(n=>({...n,id:r.id,borrower_name:r.name,loan_amount:r.basic_salary}))},className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select an Employee"}),s==null?void 0:s.map(a=>e.jsxs("option",{value:a.id,children:[a.name," - ",a.employee_id]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Loan Amount"}),e.jsx("input",{type:"number",value:t.loan_amount,onChange:a=>l("loan_amount",a.target.value),className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Payable Amount"}),e.jsx("input",{type:"number",value:t.payable_amount,onChange:a=>{const d=Number(a.target.value),r=Number(t.loan_amount)||0;l({...t,payable_amount:d,remaining_amount:r-d})},className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Remaining Amount"}),e.jsx("input",{type:"number",value:t.remaining_amount||0,readOnly:!0,className:"mt-1 w-full border border-gray-300 rounded-md p-2 bg-gray-100 text-gray-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Loan Date"}),e.jsx(u,{selected:t.loan_date,onChange:a=>l("loan_date",a),dateFormat:"yyyy-MM-dd",className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Due Date"}),e.jsx(u,{selected:t.due_date,onChange:a=>l("due_date",a),dateFormat:"yyyy-MM-dd",className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Remarks"}),e.jsx("textarea",{value:t.remarks,onChange:a=>l("remarks",a.target.value),className:"mt-1 w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500",rows:"3"})]}),e.jsxs("button",{onClick:v,className:"w-full py-2 px-4 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 flex items-center justify-center",children:[y?e.jsx(D,{className:"animate-spin mr-2"}):null,"Submit"]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Existing Advance Salary"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300 bg-white shadow-lg rounded-lg overflow-hidden",children:[e.jsx("thead",{className:"bg-blue-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"Employee ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"Employee Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"Payable Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"Remarks"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-bold text-white uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:p.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-700",children:["EMP00000",a.id]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:a.borrower_name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:a.payable_amount}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:a.remarks}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-700",children:[e.jsx("button",{onClick:()=>handleEdit(a),className:"text-blue-500 mr-2"}),e.jsx("button",{onClick:()=>handleDelete(a.id),className:"text-red-500"})]})]},a.id))})]})})]})]})]})};export{R as default};
