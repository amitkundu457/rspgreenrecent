import{r,q as Q,j as e,a as c,b as p}from"./app-DcosoOGz.js";import{H as U,N as X,a as G}from"./Header-CpISEJT8.js";import{c as J}from"./index-BdICc8gQ.js";import{a as K}from"./index-CWrYJs3k.js";import{R as V}from"./index-BmEqggIL.js";import"./iconBase-BoGeFUZy.js";const W=d=>{const i={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(d).toLocaleDateString(void 0,i)},le=({leave:d,user:i,user_type:l,notif:L})=>{var w,C;const[S,k]=r.useState([]),[n,D]=r.useState(""),[j,E]=r.useState([]),[f,b]=r.useState(1),[x]=r.useState(10),[P,A]=r.useState(!1),[N,R]=r.useState(null),[g,o]=r.useState(!1),[h,T]=r.useState("");r.useEffect(()=>{Array.isArray(l)?k(l):console.error("Expected user_type to be an array:",l)},[l]),r.useEffect(()=>{const t=d.filter(s=>s.name.toLowerCase().includes(n.toLowerCase())||s.type_name.toLowerCase().includes(n.toLowerCase())||s.reason.toLowerCase().includes(n.toLowerCase()));E(t)},[n,d]);const v=f*x,F=v-x,y=j.slice(F,v),$=Math.ceil(j.length/x),M=Array.from({length:$},(t,s)=>s+1),O=t=>{D(t.target.value),b(1)},_=async t=>{try{if(!h.trim()){alert("Please provide a reason for rejection");return}await p.post(`/leave-reject/${t}`,{reason:h}),alert("Leave rejected successfully"),o(!1),window.location.reload()}catch(s){console.error("There was an error rejecting the leave!",s)}},q=async t=>{try{await p.post(`/leave-approve/${t}`),alert("Leave approved successfully"),window.location.reload()}catch(s){console.error("There was an error approving the leave!",s)}},z=async(t,s)=>{if(t.preventDefault(),window.confirm("Are you sure you want to delete this leave?"))try{await p.get(`/leave-store-delete/${s}`),alert("Leave deleted successfully"),window.location.reload()}catch(a){console.error("There was an error deleting the leave!",a)}},{props:m}=Q(),B=(t,s)=>{const a=new Date(t),H=new Date(s),I=Math.abs(H-a);return Math.ceil(I/(1e3*60*60*24))+1},u=t=>{R(N===t?null:t)};return e.jsxs("div",{className:"w-[85.2%] px-8 absolute right-0 overflow-hidden",children:[e.jsx(U,{user:i,notif:L}),e.jsx(X,{user_type:l}),e.jsx("div",{className:`modal absolute top-0 left-0 w-full h-full transition-all duration-500 bg-black/50 flex justify-center items-center ${P?"opacity-100 visible pointer-events-auto":"opacity-0 invisible pointer-events-none"}`,children:e.jsxs("div",{className:"w-2/5 p-4 px-6 bg-white rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Modal header"}),e.jsx("button",{onClick:()=>A(!1),children:e.jsx(K,{})})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("form",{action:"#",className:"py-3 space-y-5",children:[e.jsxs("div",{className:"flex flex-col gap-2 form-group",children:[e.jsx("label",{htmlFor:"start-date",className:"text-sm font-medium",children:"Start Date"}),e.jsx("input",{id:"start-date",type:"date",className:"rounded form-input"})]}),e.jsxs("div",{className:"flex flex-col gap-2 form-group",children:[e.jsx("label",{htmlFor:"end-date",className:"text-sm font-medium",children:"End Date"}),e.jsx("input",{id:"end-date",type:"date",className:"rounded form-input"})]}),e.jsxs("div",{className:"flex flex-col gap-2 form-group",children:[e.jsx("label",{htmlFor:"number",className:"text-sm font-medium",children:"Number"}),e.jsx("input",{id:"number",type:"number",className:"rounded form-input"})]}),e.jsx("div",{children:e.jsx("button",{className:"px-8 py-2 text-sm font-semibold text-white bg-blue-500 rounded-md",children:"Submit"})})]})]})}),e.jsxs("div",{className:"px-8 table-section",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("input",{type:"text",value:n,onChange:O,placeholder:"Search employees...",className:"w-1/3 p-2 border rounded-md"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"grid p-2 mt-2 text-black rounded-lg place-items-center",children:e.jsx(c,{href:"leave-create",className:"underline",children:"Add New"})}),S.includes("view_leave_type")&&((w=m.auth.user.roles[0])==null?void 0:w.name)==="admin"&&e.jsx("div",{className:"grid p-2 mt-2 text-black rounded-lg place-items-center",children:e.jsx(c,{href:"leave-type",children:"Leave Type"})})]})]}),e.jsx("br",{}),e.jsxs("table",{className:"table w-full p-4 border",children:[e.jsx("thead",{className:"border bg-[#0A1B3F] text-white",children:e.jsxs("tr",{children:[((C=m.auth.user.roles[0])==null?void 0:C.name)==="admin"&&e.jsx("th",{className:"p-3 text-left border",children:"Employee Name"}),e.jsx("th",{className:"p-3 text-left border",children:"Leave Type"}),e.jsx("th",{className:"p-3 text-left border",children:"Applied On"}),e.jsx("th",{className:"p-3 text-left border",children:"Start Date"}),e.jsx("th",{className:"p-3 text-left border",children:"End Date"}),e.jsx("th",{className:"p-3 text-left border",children:"Total Days"}),e.jsx("th",{className:"p-3 text-left border",children:"Leave Reason"}),e.jsx("th",{className:"p-3 text-left border",children:"Extra Leave"}),e.jsx("th",{className:"p-3 text-left border",children:"Status"}),e.jsx("th",{className:"p-3 text-left border",children:"Action"})]})}),e.jsx("tbody",{children:y.length>0?y.map(t=>{var s;return e.jsxs("tr",{children:[((s=m.auth.user.roles[0])==null?void 0:s.name)==="admin"&&e.jsx("td",{className:"p-3 border",children:t.name}),e.jsx("td",{className:"p-3 border",children:t.type_name}),e.jsx("td",{className:"p-3 border",children:W(t.created_at)}),e.jsx("td",{className:"p-3 border",children:t.sdate}),e.jsx("td",{className:"p-3 border",children:t.edate}),e.jsx("td",{className:"p-3 border",children:B(t.sdate,t.edate)}),e.jsx("td",{className:"p-3 border",children:t.reason}),e.jsx("td",{className:"p-3 border",children:t.is_unpaid===1?e.jsx("p",{className:"text-[1rem] text-center",children:"Unpaid"}):e.jsx("p",{className:"text-[1rem] text-center",children:"Paid"})}),e.jsxs("td",{className:"p-3 border relative",onClick:()=>{g||u(t.id)},children:[i==="Admin"?e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:t.status===0?"px-2 py-1 m-1 text-blue-700 rounded transition-colors duration-300 ease-in-out":t.status===1?"px-2 py-1 m-1 text-red-700 rounded transition-colors duration-300 ease-in-out":t.status===2?"px-2 py-1 m-1 text-gray-700 rounded transition-colors duration-300 ease-in-out":"",onClick:a=>{a.stopPropagation(),u(t.id)},children:t.status===0?"Approve":t.status===1?"Reject":t.status===2?"Pending":""}),e.jsx("div",{className:`absolute left-0 top-0 h-[6rem] z-40 mt-9 bg-white rounded shadow-lg transition-all duration-300 ease-in-out overflow-hidden ${N===t.id?"max-h-screen opacity-100":"max-h-0 opacity-0"}`,children:e.jsxs("div",{children:[e.jsx("p",{onClick:a=>{a.stopPropagation(),q(t.id)},className:"text-gray-800 p-2 hover:text-green-500 cursor-pointer",children:"Approve"}),e.jsx("hr",{}),e.jsx("p",{onClick:a=>{a.stopPropagation(),o(!0),u(null)},className:"text-gray-800 p-2 hover:text-red-500 cursor-pointer",children:"Reject"})]})})]}):t.status===0?e.jsx("span",{className:"text-blue-500",children:"Approve"}):t.status===1?e.jsx("span",{className:"text-red-700",children:"Reject"}):t.status===2?e.jsx("span",{className:"text-gray-900",children:"Pending"}):"",g&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:()=>o(!1),children:e.jsxs("div",{className:"bg-white p-5 rounded shadow-lg w-[90%] max-w-md relative",onClick:a=>a.stopPropagation(),children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700",onClick:()=>o(!1),children:"âœ•"}),e.jsx("h2",{className:"text-lg font-bold mb-3",children:"Rejection Reason"}),e.jsx("textarea",{value:h,onChange:a=>T(a.target.value),placeholder:"Enter the reason for rejection...",className:"w-full p-2 border rounded mb-3",rows:4}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>o(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:()=>_(t.id),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Submit"})]})]})})]}),e.jsx("td",{className:"border",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{className:"text-white p-2 rounded text-[1.5rem] bg-blue-500",href:`leave/show/${t.id}`,children:e.jsx(G,{})}),e.jsx(c,{className:"bg-green-800 p-2 rounded text-white text-[1.5rem]",href:`leave-store-edit/${t.id}`,children:e.jsx(J,{})}),e.jsx("button",{className:"bg-red-800 p-2 rounded text-white text-[1.5rem]",onClick:a=>z(a,t.id),children:e.jsx(V,{})})]})})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"py-4 text-center",children:"No results found"})})})]}),e.jsx("div",{className:"flex justify-between mt-4",children:e.jsx("div",{className:"flex items-center space-x-2",children:M.map(t=>e.jsx("button",{onClick:()=>b(t),className:`px-4 py-2 rounded ${f===t?"bg-blue-500 text-white":"bg-gray-200"}`,children:t},t))})})]})]})};export{le as default};
